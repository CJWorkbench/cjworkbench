<header>
  <h1>Filtering data<h1>
  <p>Filtering data is a common, yet powerful analysis technique. Learn how to use Conditional and value filters to explore your data.</p> 
</header>

<section class="fullscreen">
  <h2>Introduction</h2>
  <p>
    Filtering data is a common, yet powerful analysis technique. You can use it to answer questions such as “Which cities spent more than a million dollars on snow removal last year?”
  </p>
  <p>
    Filtering is also a key intermediate step in many analysis, or to explore data you are just starting to work with.
  </p>
  <p>
    In this lesson we will work with open data from the City of San Francisco, on the amount of affordable housing planned to be built.
  </p>
</section>

<!-- Section 1 -->

<script id="initialWorkflow" type="application/json">
  {
    "tabs": [
      {
        "name": "Lesson",
        "wfModules": [
          {
            "module":"loadurl",
            "params": {
              "url":"http://production-static.workbenchdata.com/data/intro-data-j/affordable-housing-pipeline.csv"
            }
          }
        ]
      },
      {
        "name": "Data dictionary",
        "wfModules": [
          {
            "module":"loadurl",
            "params": {
              "url":"http://production-static.workbenchdata.com/data/intro-data-j/dataDictionary-affordable-housing-pipeline.csv"
            }
          }
        ]
      }
    ]
  }
</script>

<section>
  <h2>Data</h2>
  <p>The data we're using in this lesson is a quarterly snapshot of every housing projects in construction in San Francisco. Each row is project in development.</p>
  <p>
    This data is published and documented by the City of San Francisco <a class="highlight" href='https://data.sfgov.org/Housing-and-Buildings/Affordable-Housing-Pipeline/aaxw-2cb8' target="_blank" className="info-1">here</a>.
  </p>
  <p>
    This data is published together with a data dictionary to explain the meaning of columns, which we’ve loaded in a separate tab.
  </p>
  <h3 class="instructions">Instructions</h3>
  <p class="instruction-detail">Again, let’s ask the basic questions:</p>
  <ol class="steps">
    <li
      data-highlight='[{"type":"Module","index":0,"name":"Add from URL"}]'
      data-test="return workflow.tabs[0].wfModuleNames[0] === 'Add from URL'"
      >What does each row represent?
    </li>
    <li
      data-highlight='[{"type":"Module","index":0,"name":"Add from URL"}]'
      data-test="return workflow.tabs[0].wfModuleNames[0] === 'Add from URL'"
      >What's in each column?
    </li>
    <li
      data-highlight='[{"type":"Module","index":0,"name":"Add from URL"}]'
      data-test="return workflow.tabs[0].wfModuleNames[0] === 'Add from URL'"
      >Are there any columns, values or codes you don't understand?
    </li>
    <li
      data-highlight='[{"type":"Module","index":0,"name":"Add from URL"}]'
      data-test="return workflow.tabs[0].wfModuleNames[0] === 'Add from URL'"
      >Are there missing or obviously wrong values?
    </li>
    <li
      data-highlight='[]'
      data-test="return workflow.tabs[0].wfModuleNames[0] === 'Add from URL'"
      >Does the data need to be cleaned?
    </li>
  </ol>
</section>
<section>
  <h2>Cleaning</h2>
  <p>
    This table contains many columns which makes it difficult to navigate. Let’s narrow it down to data we’re interested in.
  </p>
  <p>
    Let's also add a note about the data source.
  </p>
  <h3 class="instructions">Instructions</h3>
  <ol class="steps">
    <li
      data-highlight='[{"type":"Module","index":0,"name":"Add from URL"}]'
      data-test="return workflow.tabs[0].wfModuleNames[0] === 'Add from URL'"
      >Add the provenance of the data using a note:
      <div class="copy-txt">Source: City of San Francisco</div>
    </li>
    <li
      data-highlight='[{"type":"Module","index":0,"name":"Add from URL"}]'
      data-test="return workflow.tabs[0].wfModuleNames[0] === 'Add from URL'"
      >Add a Select column step and keep the following columns (Start typing column names in the selector to go faster)
      <p>
        <kbd>Planning neighborhood</kbd><br>
        <kbd>Project status</kbd><br>
        <kbd>Project Units</kbd><br>
        <kbd>% affordable</kbd><br>
        <kbd>Affordable units</kbd><br>
      </p>
    </li>
  </ol>
</section>
<section>
  <h2>Filter rows by condition</h2>
  <p>Let’s find out how many projects include more than 50% affordable units.</p>
  <p>
    Instead of sorting the column <kbd>% Affordable</kbd>, we’ll only keep projects that meet our condition, so that we can count them and continue working with that subset.
  </p>
  <h3 class="instructions">Instructions</h3>
  <ol class="steps">
    <li
      data-highlight='[{"type":"Module","index":0,"name":"Add from URL"}]'
      data-test="return workflow.tabs[0].wfModuleNames[0] === 'Add from URL'"
      >Add <kbd>Filter by condition</kbd>
    </li>
    <li
      data-highlight='[{"type":"Module","index":0,"name":"Add from URL"}]'
      data-test="return workflow.tabs[0].wfModuleNames[0] === 'Add from URL'"
      >Select the column <kbd>% Affordable</kbd>
    </li>
    <li
      data-highlight='[{"type":"Module","index":0,"name":"Add from URL"}]'
      data-test="return workflow.tabs[0].wfModuleNames[0] === 'Add from URL'"
      >Set the condition to <kbd>greater than</kbd> and set the value to <kbd>50</kbd>.
      <p class ="instruction-detail">
        At the top left of the table, we see that 119 rows are left. This means that 119 projects include more than 50% affordable units.
      </p>
      <!-- <p class ="instruction-detail">
        How many projects include more than 50% affordable units?
        <div class="copy-txt">
          Your answer
        </div>
      </p> -->
    </li>
  </ol>
</section>
<section>
  <h2>Multiple conditions</h2>
  <p>
    Now we can see the projects that have a majority of affordable housing. How many of these are large?
  </p>
  <p>
    Let’s continue our exploration with the question: ‘How many of those projects contain at least 100 affordable units’?
  </p>
  <p>
    We can add another condition to keep only projects containing a minimum number affordable units.
  </p>
  <h3 class="instructions">Instructions</h3>
  <ol class="steps">
    <li
      data-highlight='[{"type":"Module","index":0,"name":"Add from URL"}]'
      data-test="return workflow.tabs[0].wfModuleNames[0] === 'Add from URL'"
      >In the Filter in step 3, click <kbd>AND</kbd> to add a new condition to the filter.
    </li>
    <li
      data-highlight='[{"type":"Module","index":0,"name":"Add from URL"}]'
      data-test="return workflow.tabs[0].wfModuleNames[0] === 'Add from URL'"
      >Set the new condition to 'If <kbd>Affordable_units</kbd> is <kbd>is greater than or equal</kbd> to <kbd>100</kbd>.
    </li>
    <li
      data-highlight='[{"type":"Module","index":0,"name":"Add from URL"}]'
      data-test="return workflow.tabs[0].wfModuleNames[0] === 'Add from URL'"
      >Apply the new settings.
      <p class ="instruction-detail">
        The table now displays all projects containing "more than 50% affordable units AND at least 100 affordable units".
      </p>
    </li>
  </ol>
</section>
<section>
  <h2>Filtering rows by values</h2>
  <p>We can also filter rows by selecting which values to include and exclude in a specific column.</p>
  <p>
    Let’s find projects that are likely to be completed by looking at the <kbd>Project Status</kbd> column.
  </p>
  <h3 class="instructions">Instructions</h3>
  <ol class="steps">
    <li
      data-highlight='[{"type":"Module","index":0,"name":"Add from URL"}]'
      data-test="return workflow.tabs[0].wfModuleNames[0] === 'Add from URL'"
      >Add the step <kbd>Filter value</kbd>.
    </li>
    <li
      data-highlight='[{"type":"Module","index":0,"name":"Add from URL"}]'
      data-test="return workflow.tabs[0].wfModuleNames[0] === 'Add from URL'"
      >Select the column <kbd>Project status</kbd>
      <p class ="instruction-detail">
        All unique values in the column <kbd>Project Status</kbd> are listed in the step, as well as how many rows use each value.
      </p>
    </li>
    <li
      data-highlight='[{"type":"Module","index":0,"name":"Add from URL"}]'
      data-test="return workflow.tabs[0].wfModuleNames[0] === 'Add from URL'"
      >In ‘Filter by value’, select <kbd>(3) Design with entitlement Approved</kbd> to see only projects that are approved for construction, but not yet started.
    </li>
    <li
      data-highlight='[{"type":"Module","index":0,"name":"Add from URL"}]'
      data-test="return workflow.tabs[0].wfModuleNames[0] === 'Add from URL'"
      >Also select <kbd>(4) Site Work Permit</kbd> to add in projects at this later stage.
      <p class ="instruction-detail">
        By changing the selected values in <kbd>Filter by value</kbd> you can quickly get insight into the projects at any combination of development stages.
      </p>
    </li>
  </ol>
</section>
<footer>
  <h2>Lesson Complete!</h2>
  <div class="completed">
    <p class="summary"> Next, we’ll continue working with this data and learn about the powerful Group step.</p>
  </div>
  <div class="next">
    <h2>Next</h2>
    <ol>
      <li>
        <a href="group">Summarizing data by grouping</a>
      </li>
    </ol>
  </div>
</footer>
