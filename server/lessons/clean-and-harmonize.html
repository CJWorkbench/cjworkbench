<header>
  <h1>Clean and standardize data</h1>
  <p>Clean format and standardize data to build a chart series.</p>
</header>
<section>
  <h2>Overview</h2>
  <p>In this lesson you will clean and prepare a dataset to visualize a chart series.</p>
  <ol class="steps">

  </ol>
</section>
<section>
  <h2>1. Deleting empty columns and rows</h2>
  <ol class="steps">
    <li
      data-highlight='[{"type":"ModuleSearch"},{"type":"MlModule","name":"Add from URL"}]'
      data-test="const wfModule = workflow.wfModules[0]; return wfModule && wfModule.parameters.get('url') === 'https://app.workbenchdata.com/static/data/population_dirty_data.csv' && wfModule.selectedVersion"
      >Add the module 'Add from URL' and paste in the following URL before clicking 'Update'.
      <div class="copy-txt content-3 t-white">https://app.workbenchdata.com/static/data/population_dirty_data.csv</div>
      <p class="lesson-note">The two columns on at the far right of the dataset are empty.</p>
    </li>
    <li
      data-highlight='[{"type":"ModuleSearch"},{"type":"MlModule","name":"Drop empty columns"}]'
      data-test="return workflow.wfModules.length > 1 && workflow.wfModules[1].moduleName === 'Drop empty columns'"
      >Add the module 'Drop empty columns.'
    </li>
    <li
      data-highlight='[{"type":"ModuleSearch"},{"type":"MlModule","name":"Drop empty rows"}]'
      data-test="return workflow.wfModules.length > 2 && workflow.wfModules[2].moduleName === 'Drop empty rows'"
      >Add the module 'Drop empty rows'.
    </li>
    <li
      data-highlight='[{"type":"WfModule","moduleName":"Drop empty rows"}]',
      data-test="return workflow.wfModules[2].parameters.get('colnames') === 'MetroArea,Population'"
      >Select the columns 'MetroArea' and 'Population'. The rows missing those values will be deleted.
    </li>
  </ol>
</section>
<section>
  <h2>2. Harmonizing column values</h2>
  <p>The same value is frequently spelled in multiple ways, or with irregular capitalization.  Ex: ‘APPLE’, ‘Apple’, ‘APL’.</p>
  <ol class="steps">
    <li
      data-highlight='[{"type":"ModuleSearch"},{"type":"MlModule","name":"Refine"}]'
      data-test="return workflow.wfModules.length > 3 && workflow.wfModules[3].moduleName === 'Refine'"
      >Add the module 'Refine'.</li>
    <li
      data-highlight='[{"type":"WfModule","moduleName":"Refine"}]'
      data-test="const json = workflow.wfModules[3].parameters.get('refine'); if (!json) return false; const allJson = JSON.parse(json); const changes = allJson.filter(x => x.type === 'change').map(x => x.content); if (changes.length !== 8) { console.log('Expect user to change Refine 8 times; found ' + changes.length + ' changes'); return false } const uniqueVals = {}; changes.forEach(x => uniqueVals[x.toVal] = null); if (Object.keys(uniqueVals).length !== 5) { console.log('Expect 5 unique values in Refine for MetroArea; found: ' + JSON.stringify(Object.keys(uniqueVals))); return false; } return true"
      >Select the column ‘MetroArea’ which contains messy data.
      <p>
        Edit values in the list until each one is displayed only once.
      </p>
      <p>
        <img class="image" src="/static/images/lesson_2/refine_row.svg">
      </p>
      <p class="lesson-note">
       When you're done, the list should look as follow:
      </p>
      <p>
        <img class="image" src="/static/images/lesson_2/refine_result.svg">
      </p>
    </li>
    <li
      data-highlight='[]'
      data-test="const params = workflow.wfModules[3].moduleName.parameters; return params.get('column') === 'MetroArea'"
    >Un-check 'Denver - Aurora', which contains incomplete data.
    </li>
  </ol>
</section>
<section>
  <h2>3. Changing table format</h2>
  <p>The table is currently in a 'long' format, where each row is a unique observation. In order to make it more legible, we need to display it in the 'wide' format, used in most spreadshseets.</p>
  <p>
    <img class="image" src="/static/images/lesson_2/long_wide.svg" style="width:28rem;">
  </p>
  <ol class="steps">
    <li
      data-highlight='[]'
      data-test="return workflow.wfModules.length > 2 && workflow.wfModules[1].moduleName === 'Filter'"
      >Add the module ‘Reshape’, and select 'Long to wide'.</li>
    <li
      data-highlight='[]'
      data-test="const params = workflow.wfModules[1].moduleName.parameters; return params.get('column') === 'affordable_units' && params.get('condition') === 'Greater Than' && params.get('value') === '200' && params.get('keep') === 'Keep'"
      >Choose 'Year' as the Key column. Those values will be displayed in most left columns of the wide table.</li>
    <li
      data-highlight='[]'
      data-test="return state.selectedWfModule.moduleName === 'Column chart'"
      >Choose 'MetroArea' as the Variable column. Those values will be displayed in the header.</li>
  </ol>
</section>
<section>
  <h2>4. Making a line Chart with series</h2>
  <p>Let’s create a line chart to compare the growth of population between each geographic area.</p>
  <ol class="steps">
    <li
      data-highlight='[{"type":"ModuleSearch"},{"type":"MlModule","name":"Line Chart"}]'
      data-test="return workflow.wfModules.length > 1 && workflow.wfModules[workflow.wfModules.length-1].moduleName === 'Column Chart'"
      >Add the module ‘Line Chart’ using the search in the module library.</li>
    <li
      data-highlight='[{"type":"WfModule","moduleName":"Column Chart"}]'
      data-test="return workflow.wfModules.length > 1 && JSON.parse(workflow.wfModules[workflow.wfModules.length-1].parameters.get('chart_editor')).metadata.title"
      >Add a title to the chart, and you're done!</li>
  </ol>
</section>
