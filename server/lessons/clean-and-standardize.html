<header>
  <h1>II. Clean and standardize data</h1>
  <p>Clean a messy dataset and format it in order to build a chart series</p>
  <img src="/static/images/lesson_banners/clean_standard_banner.svg">
</header>
<section>
  <h2>Overview</h2>
  <p>In this tutorial you will work with messy data to compare population growth in major U.S. metro areas.</p>
  <p>You will clean columns and rows, standardize values to make the dataset actionable, and reshape the table from long to wide format to gain insight and build a chart series.</p>
  <ol class="steps">

  </ol>
</section>
<section>
  <h2>1. Dropping empty rows and columns</h2>
  <p> For the purpose of this lesson, the dataset is hosted on Workbench.</p>
  <h3 class="instructions">Instructions</h3>
  <ol class="steps">
    <li
      data-highlight='[{"type":"Module","index":0,"name":"Add from URL"}]'
      data-test="return workflow.wfModules.length > 0 && workflow.wfModules[0].moduleName === 'Add from URL'"
      >Add the module 'Add from URL'.
    </li>
    <li
      data-highlight='[{"type":"WfModule","moduleName":"Add from URL"}]'
      data-test="const wfModule = workflow.wfModules[0]; return wfModule.parameters.get('url') === 'https://app.workbenchdata.com/static/data/population_dirty_data.csv' && wfModule.selectedVersion"
      >Paste in the following URL and click <kbd>Update</kbd> to load the data.
      <div class="copy-txt content-3 t-white">https://app.workbenchdata.com/static/data/population_dirty_data.csv</div>
      <p class="instruction-detail">The two columns at the far right of the dataset are empty.</p>
    </li>
    <li
      data-highlight='[{"type":"Module","index":1,"name":"Drop empty columns"}]'
      data-test="return workflow.wfModules.length > 1 && workflow.wfModules[1].moduleName === 'Drop empty columns'"
      >Add the module 'Drop empty columns.'
    </li>
    <li
      data-highlight='[{"type":"Module","index":2,"name":"Drop empty rows"}]'
      data-test="return workflow.wfModules.length > 2 && workflow.wfModules[2].moduleName === 'Drop empty rows'"
      >Add the module 'Drop empty rows'.
    </li>
    <li
      data-highlight='[{"type":"WfModule","moduleName":"Drop empty rows"}]',
      data-test="return workflow.wfModules[2].parameters.get('colnames') === 'MetroArea,Population'"
      >In the module, select columns <kbd>MetroArea</kbd> and <kbd>Population</kbd>. The rows missing values in those columns will be deleted.
    </li>
  </ol>
</section>
<section>
  <h2>2. Standardize column values</h2>
  <h3 class="instructions">Instructions</h3>
  <p>In the column <kbd>MetroArea</kbd> the same value is spelled in multiple ways, or with irregular capitalization.  Ex: ‘Bay Area’, ‘SF - Bay Area’, ‘San Jose-San Francisco-Oakland’.</p>
  <ol class="steps">
    <li
      data-highlight='[{"type":"Module","index":3,"name":"Refine"}]'
      data-test="return workflow.wfModules.length > 3 && workflow.wfModules[3].moduleName === 'Refine'"
      >Add the module 'Refine' using the search in the Module Library.</li>
    <li
      data-highlight='[{"type":"WfModule","moduleName":"Refine"}]'
      data-test="const params = workflow.wfModules[3].parameters; if (params.get('column') !== 'MetroArea') return false; const json = params.get('refine'); if (!json) return false; const allJson = JSON.parse(json); const changes = allJson.filter(x => x.type === 'change').map(x => x.content.fromVal); const Expected = [ 'San Jose-San Francisco-Oakland', 'Austin', 'Bay Area', 'DallasFORTHWorth', 'SF - BAY AREA' ]; for (var i = 0; i < Expected.length; i++) { if (changes.indexOf(Expected[i]) === -1) { console.log('User has yet to rename ' + Expected[i] + '; changes were ' + JSON.stringify(changes)); return false; } } return true;"
      >Select the column <kbd>MetroArea</kbd> which contains messy data. Edit values in the list until each one is displayed only once.
      <figure>
        <img alt="Inspect element" src="/static/images/clean_standardize_lesson/1_refine_row.png">
      </figure>
      <p class="instruction-detail">
       When you're done, the list should look similar to the following:
      </p>
      <figure>
        <img alt="Inspect element" src="/static/images/clean_standardize_lesson/2_refine_result.png">
      </figure>
    </li>
    <li
      data-highlight='[{"type":"WfModule","moduleName":"Refine"}]'
      data-test="const params = workflow.wfModules[3].parameters; const json = JSON.parse(params.get('refine')); return json.filter(x => x.type === 'select' && x.content.value === 'Denver - Aurora').length > 0"
    >Un-check <kbd>Denver - Aurora</kbd> which contains incomplete data.
    </li>
  </ol>
</section>
<section>
  <h2>3. Changing table format</h2>
  <p>The table is currently in a 'long' format, where each row is a unique observation. In order to make it more legible, we need to display it in the 'wide' format, used in most spreadshseets.</p>
  <h3 class="instructions">Instructions</h3>
  <ol class="steps">
    <li
      data-highlight='[{"type":"Module","index":4,"name":"Reshape" }]'
      data-test="return workflow.wfModules.length > 4 && workflow.wfModules[4].moduleName === 'Reshape'"
      >Add the module ‘Reshape’.
      <figure>
        <img alt="Inspect element" src="/static/images/clean_standardize_lesson/3_reshape_long_wide.png">
      </figure>
    </li>
    <li
      data-highlight='[{"type":"WfModule","moduleName":"Reshape"}]'
      data-test="return workflow.wfModules[4].parameters.get('direction') === 1"
      >Select <kbd>Long to wide</kbd>.
    </li>
    <li
      data-highlight='[{"type":"WfModule","moduleName":"Reshape"}]'
      data-test="return workflow.wfModules[4].parameters.get('colnames') == 'Year'"
      >Choose <kbd>Year</kbd> as the Row variable. Those values will be displayed in leftmost column of the wide table.</li>
    <li
      data-highlight='[{"type":"WfModule","moduleName":"Reshape"}]'
      data-test="return workflow.wfModules[4].parameters.get('varcol') == 'MetroArea'"
      >Choose <kbd>MetroArea</kbd> as the Column variable. Those values will be used in the column header in the wide table.
      <p class="instruction-detail highlight">Congratulation! Your data and ready for analysis.</p>
      <span class="instruction-detail"> Next, learn <a href="https://app.workbenchdata.com/lessons/scrape-using-xpath/" class="highlight" target="_blank">how to scrape and monitor content on a web page.</a></span>
    </li>
  </ol>
</section>
