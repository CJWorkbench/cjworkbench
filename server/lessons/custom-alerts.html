<header>
  <h1>VI. Monitor data and set custom alerts</h1>
  <p>Coming soon</p>
  <img src="/static/images/lesson_banners/monitor_public_data.svg">
</header>
<section>
  <h2>OVERVIEW</h2>
  <p>For the purpose of this lesson we'll work with data on Police Incidents from the City of San Francisco.</p>
</section>
<section>
  <h2>1. Automatic updates</h2>
  <p>First, we need to check the source data periodically, and download any new version available to keep the workflow up-to-date.</p>
  <p>The source dataset is published <a href="https://data.sfgov.org/Public-Safety/-Change-Notice-Police-Department-Incidents/tmnf-yvry" class="highlight" target="_blank">here</a>.</p>
  <h3 class="instructions">Instructions</h3>
  <ol class="steps">
    <li
      data-highlight='[{"type":"Module","index":0,"name":"Add from URL"}]'
      data-test="return workflow.wfModules.length > 0 && workflow.wfModules[0].moduleName === 'Add from URL'"
      >Add the module 'Add from URL'.
    </li>
    <li
      data-highlight='[{"type":"WfModule","moduleName":"Add from URL"}]'
      data-test="const wfModule = workflow.wfModules[0]; return wfModule.parameters.get('url') === 'https://data.sfgov.org/resource/cuks-n6tp.json' && wfModule.selectedVersion"
      >Paste in the following URL and click <kbd>Update</kbd> to load the data.
      <div class="copy-txt content-3 t-white">https://data.sfgov.org/resource/cuks-n6tp.json</div>
    </li>
    <li
      data-highlight='[{"type":"WfModule","moduleName":"Add from URL"}]',
      data-test="const wfModule = workflow.wfModules[0]; return wfModule.updateInterval === '5h'"
      >Click <kbd>manual</kbd> to open the Workflow Update dialog. Turn the feature <kbd>ON</kbd>, set the frequency to 5 hours, and click <kbd>Apply.</kbd>
    </li>
  </ol>
</section>
<section>
  <h2>2. Receive and email if a certain condition is met</h2>
  <p>We want to receive a notification if the number of reported police incidents exceeds 190 in any district.</p>
  <h3 class="instructions">Instructions</h3>
  <p class="instruction-detail">
    Group all rows by police district
  </p>
  <ol class="steps">
    <li
      data-highlight='[{"type":"Module","index":1,"name":"Group"}]'
      data-test="return workflow.wfModules[1] && workflow.wfModules[1].moduleName === 'Group'"
      >Add the module 'Group'.
    </li>
    <li
      data-highlight='[{"type":"WfModule","moduleName":"Group"}]'
      data-test="const params = workflow.wfModules[1].parameters; return params.get('groupby|groupby|0') === 'pddistrict' && params.get('operation|operation|0') === 0"
      >Choose <kbd>pddistrict</kbd> to group by, and leave the operation set on <kbd>Count</kbd>.
      <p class="instruction-detail"> Use the filter to create a condition.</p>
    </li>
    <li
      data-highlight='[{"type":"Module","index":2,"name":"Filter"}]'
      data-test="return workflow.wfModules[2] && workflow.wfModules[2].moduleName === 'Filter'"
      >Add the module 'Filter'.
    </li>
    <li
      data-highlight='[{"type":"WfModule","moduleName":"Filter"}]'
      data-test="const params = workflow.wfModules[2].parameters; return params.get('column') === 'Group Size' && params.get('condition') === 10 && params.get('value') === '30'"
      >Select the column <kbd>group size</kbd> to filter by. Choose <kbd>greater than</kbd> as a condition, and type in <kbd>150</kbd>
      <p class="instruction-detail">
        The output of the Filter module will now display any row with a count > 190. Let's turn this module's alert on:
      </p>
    </li>
    <li
      data-highlight='[{"type":"WfModule","moduleName":"Filter"}]'
      data-test="return workflow.wfModules[2].isEmailUpdates"
      >In the filter module, click on the bell icon. Turn on the alert and close the window.
      <p class="instruction-detail">Congrats message! You're now a full stack developer! Another blurb about version and link to knowledge base</p>
    </li>
  </ol>
</section>
