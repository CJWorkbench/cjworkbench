$schema: https://json-schema.org/schema#
type: object
required: [ id_name, name, category, parameters ]
properties:
    id_name:
        type: string
        description: Name that programmers use to uniquely define this Module
    name:
        type: string
        description: Name that appears atop the Step and in Module Search
    category:
        type: string
        description: Category that appears in Module Search
    icon:
        type: string
        description: "Icon name that appears in Module Search and atop the Step (default: 'url')"
    link:
        type: string
        description: "URL the code comes from (default: '')"
        format: uri
    description:
        type: string
        description: "Description that appears in Module Search (default: '')"
    loads_data:
        type: boolean
        description: "True if this Step can do 'fetches' that may produce new data each run (default: False)"
    html_output:
        type: boolean
        description: "True if this Step outputs an iframe (default: False)"
    has_zen_mode:
        type: boolean
        description: "True if the user can zoom in on only this one Step (default: False)"
    row_action_menu_entry_title:
        type: string
        description: "If set, text of a selected-rows menu entry that adds this Step"
    help_url:
        type: string
        description: "Path (not URL) of documentation (format: x/y/x; default: '')"
    param_schema:
        type: object
        description: "Schema of parameters generated by `parameters` (default: derived from `parameters`)"
        additionalProperties:
            $ref: '#/definitions/dtypes/any'

    parameters:
        type: array
        description: "Specification for how to give a form to the user and give values to the fetch/render functions"
        items:
            type: object
            required: [ id_name, type ]
            properties:
                id_name:
                    type: string
                    description: Name that programmers use to uniquely define this parameter
                type:
                    type: string
                    enum: [ statictext, string, integer, float, checkbox, menu, button, column, radio, multicolumn, secret, custom ]
                    description: Form field type
                name:
                    type: string
                    description: "Name that may appears with the form field (only for some types) (default: '')"
                placeholder:
                    type: string
                    description: "Text that appears when the form field has no value (only for some types) (default: '')"
                menu_items:
                    type: string
                    description: "Menu entries, separated by '|' (only for menu type) (default: '')"
                radio_items:
                    type: string
                    description: "Radio entries, separated by '|' (only for radio type) (default: '')"
                default:
                    description: "Value to set on the user's behalf while creating new modules or auto-migrating params (when the user's params do not include a value) (default: null)"
                visible_if:
                    type: object
                    required: [ id_name, value ]
                    properties:
                        id_name:
                            type: string
                            description: id_name of the param we will investigate
                        value:
                            description: "Value we expect (there are so many unique cases, it's not worth documenting them all)"
                        invert:
                            type: boolean
                            description: "If true, do the opposite"
definitions:
    dtypes:
        string:
            type: object
            required: [ type ]
            properties:
                type: { const: string }
                default: { type: string }
        integer:
            type: object
            required: [ type ]
            properties:
                type: { const: integer }
                default: { type: integer }
        float:
            type: object
            required: [ type ]
            properties:
                type: { const: float }
                default: { type: number }
        boolean:
            type: object
            required: [ type ]
            properties:
                type: { const: boolean }
                default: { type: boolean }
        enum:
            type: object
            required: [ type, choices, default ]
            properties:
                type: { const: enum }
                choices: { type: array }
                default: {}
        column:
            type: object
            required: [ type ]
            properties:
                type: { const: column }
        multicolumn:
            type: object
            required: [ type ]
            properties:
                type: { const: multicolumn }
        list:
            type: object
            requred: [ type, inner_dtype ]
            properties:
                type: { const: list }
                inner_dtype: { '$ref': '#/definitions/dtypes/any' }
        dict:
            type: object
            required: [ type, properties ]
            properties:
                type: { const: dict }
                properties:
                    type: object
                    additionalProperties: { '$ref': '#/definitions/dtypes/any' }
        any:
            anyOf: [
                { $ref: '#/definitions/dtypes/string' },
                { $ref: '#/definitions/dtypes/integer' },
                { $ref: '#/definitions/dtypes/float' },
                { $ref: '#/definitions/dtypes/boolean' },
                { $ref: '#/definitions/dtypes/column' },
                { $ref: '#/definitions/dtypes/multicolumn' },
                { $ref: '#/definitions/dtypes/enum' },
                { $ref: '#/definitions/dtypes/list' },
                { $ref: '#/definitions/dtypes/dict' },
            ]
