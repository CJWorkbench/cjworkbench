version: '3.4'
# These settings are specific to dev mode

services:
  upload-assets:
    build:
      context: ..
      target: upload-assets

  migrate:
    build:
      context: ..
      target: migrate

  fetcher:
    build:
      context: ..
      target: fetcher

  renderer:
    build:
      context: ..
      target: renderer

  cron:
    build:
      context: ..
      target: cron

  cron-delta-deleter:
    build:
      context: ..
      target: cron

  cron-expired-session-deleter:
    build:
      context: ..
      target: cron

  cron-lesson-workflow-deleter:
    build:
      context: ..
      target: cron

  frontend:
    build:
      context: ..
      target: frontend

  tusd-hooks:
    build:
      context: ..
      target: tusd-hooks

  integration-test:
    build:
      context: ..
      dockerfile: Dockerfile.integrationtest
      target: dev
    # Allow access using vncviewer
    ports: [ '5901:5901' ]
    volumes:
      # Allow editing code in dev mode
      - .:/app/integrationtests
